
<!DOCTYPE html>
<html>
<head>
	<style type="text/css">
	body { margin: 0; }
	canvas { width: 100%; height: 100% }
</style>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r113/build/three.min.js"></script>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r113/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r113/examples/js/loaders/GLTFLoader.js"></script>
<!-- <script type="text/javascript" src="https://azcotic.github.io/threefolder/stats.module.js"></script>
<script type="text/javascript" src="https://azcotic.github.io/threefolder/MathUtils.js"></script> -->
 
<script src="https://azcotic.github.io/threefolder/Detector.js"></script>
<script src="https://azcotic.github.io/threefolder/Stats.js"></script>
<script src="https://azcotic.github.io/threefolder/OrbitControls.js"></script>
<script src="https://azcotic.github.io/threefolder/THREEx.KeyboardState.js"></script>
<script src="https://azcotic.github.io/threefolder/THREEx.FullScreen.js"></script>
<script src="https://azcotic.github.io/threefolder/THREEx.WindowResize.js"></script>
<script src="https://azcotic.github.io/threefolder/Projector.js"></script>
	<title>Prueba Three.js</title>
</head>
<body>
	<div id="container"></div>


	<script type="text/javascript">
		//Declaraciones

var mesh, renderer, scene, camera, controls, stats;
var keyboard = new THREEx.KeyboardState();
var modelOut;


//Declaraciones para Ray
var raycaster = new THREE.Raycaster();
var mouse = new THREE.Vector2();

init();
animate();

function init() {

  // renderer
  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // scene
  scene = new THREE.Scene();


  // camera
  camera = new THREE.PerspectiveCamera(105, window.innerWidth / window.innerHeight, 0.1, 2000);
  
  camera.position.set(1, 100, 30);
  
  camera.lookAt(0, 3, 0);

  console.log("V4");


  // controls
  controls = new THREE.OrbitControls(camera);

  // ambient
  scene.add(new THREE.AmbientLight(0x888888));

  // light
  var light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(20, 20, 0);
  scene.add(light);
  //projector 
  projector = new THREE.Projector();

  // STATS
  stats = new Stats();
  stats.domElement.style.position = 'absolute';
  stats.domElement.style.bottom = '0px';
  stats.domElement.style.zIndex = 100;
  container.appendChild(stats.domElement);

  // axes
  //scene.add( new THREE.AxisHelper( 20 ) );

  var manager = new THREE.LoadingManager();
  manager.onProgress = function(item, loaded, total) {
    console.log(item, loaded, total);
  };


  //Otro Mesh
  /*var MovingCubeMat = new THREE.MeshBasicMaterial({
    color: 0xffff00
  });
  var MovingCubeGeom = new THREE.CubeGeometry(50, 50, 50, 1, 1, 1);
  MovingCube = new THREE.Mesh(MovingCubeGeom, MovingCubeMat);
  MovingCube.position.set(0, 25.1, 0);
  scene.add(MovingCube);
  console.log("Cubo", MovingCube);*/

  //Cargar 3D
  var loader = new THREE.GLTFLoader();
  loader.setCrossOrigin('anonymous');

  var scale = 1;
  var url2 = "https://azcotic.github.io/threefolder/Textures/elf_girl/scene.gltf";
  var url3 = "https://azcotic.github.io/threefolder/Textures/man/scene3.gltf";
  var url4 = "https://azcotic.github.io/threefolder/Textures/woman/scene.gltf";
  var url = "https://azcotic.github.io/threefolder/Textures/scene.gltf";
  var man = "https://azcotic.github.io/threefolder/Textures/man.gltf";
  var woman = "https://azcotic.github.io/threefolder/Textures/woman.gltf";
  var textureLoader = new THREE.TextureLoader();
  var texture = textureLoader.load('https://azcotic.github.io/threefolder/Textures/skin.jpg');
  texture.flipY = false;
  var oBody;
  loader.load(url3, function(data) {
    var gltf = data; //guarda la data en variable
    //crea variable objeto

    if (gltf.scene !== undefined) {
      oBody = gltf.scene; // default scene
    } else if (gltf.scenes.length > 0) {
      oBody = gltf.scenes[0]; // other scene
    }
    oBody.traverse((o) => {
      if (o.isMesh) {
        // note: for a multi-material mesh, `o.material` may be an array,
        // in which case you'd need to set `.map` on each value.

        //o.material.color.setRGB(25,0,0); //Color Rojo
        //o.material.map = texture; //Textura de Piel
      }
    });
    oBody.scale.set(scale, scale, scale);
    var animations = gltf.animations;
    if (animations && animations.length) {
      mixer = new THREE.AnimationMixer(oBody);
      for (var i = 0; i < animations.length; i++) {
        var animation = animations[i];
        mixer.clipAction(animation).play();
      }
    }
    console.log("Body3", oBody);
    scene.add(oBody);
    modelOut = oBody;
    render();
  });



  document.addEventListener('mousedown', onDocumentMouseDown, false);
  window.addEventListener('resize', onWindowResize, false);




  function onWindowResize() {

    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize(window.innerWidth, window.innerHeight);

  }
  var selectedObject = null;

  function onDocumentMouseDown(event) {

    event.preventDefault();
    //console.log("X:",event.clientX / window.innerWidth * 2 - 1);
    //console.log("Y:",event.clientY / window.innerWidth * 2 + 1);
    if ( selectedObject ) {

				selectedObject.material.color.set( '#69f' );
				selectedObject = null;

			}

    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);

    if (!modelOut) return;

    var intersects = raycaster.intersectObject(modelOut, true);
    
    if (intersects.length > 0) {
      // There is intersection with the body
      //console.log(intersects[0].object.name);
      intersects[0].object.material.color.setRGB(25, 0, 0);
      intersects[0].object.traverse((o) => { 	
        if (o.isMesh) {
        	if (o.name==="Object_3001") {
        		console.log("No me toques la cabeza");
        		o.material.color.setRGB(25, 0, 0); //Color Rojo
        	}
        	if (o.name==="Object_3") {
        		console.log("Tengo cosquillas en todos lados");
        		o.material.color.setRGB(25, 0, 60); //Color Rojo
        	}
        	if (o.name==="Object_3003") {
        		console.log("Que tal mis pectorales?");
        		o.material.color.setRGB(25, 45, 0); //Color Rojo
        	}
        	if (o.name==="Object_3002") {
        		console.log("Puedes sentir mis cuadritos?");
        		o.material.color.setRGB(0, 0, 15); //Color Rojo
        	}
        }

      });
      //console.log(intersects[ 0 ].instanceId);
    } else {
      // Mouse doesn't intersect the body
      modelOut.traverse((o) => {
        if (o.isMesh) {
          o.material.color.setRGB(1, 1, 1); //Color normal
        }
      });
    }

  }

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.userPan = false;
  controls.userPanSpeed = 0.0;
  controls.maxDistance = 5000.0;
  controls.maxPolarAngle = Math.PI * 0.495;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 0;
}
const DEG2RAD = Math.PI / 180;

function degToRad(degrees) {
  return degrees * MathUtils.DEG2RAD;
}

function render() {

  renderer.render(scene, camera);

}

function update() {



  if (keyboard.pressed("z")) {


  }

  controls.update();
  stats.update();
}

function animate() {

  requestAnimationFrame(animate);

  controls.update();
  render();
  update();
  renderer.render(scene, camera);

}

	</script>
  </body>
  </html>